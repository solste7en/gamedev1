<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Multiplayer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêç</text></svg>">
    <link rel="stylesheet" href="static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Main Menu -->
        <div id="menu-screen" class="screen active">
            <div class="menu-container">
                <h1 class="game-title">üéÆ GAME HUB</h1>
                <h2 class="game-subtitle">MULTIPLAYER ARENA</h2>
                
                <div class="player-name-section">
                    <label for="player-name">Your Name</label>
                    <div class="name-input-row">
                        <input type="text" id="player-name" maxlength="12" placeholder="Enter name...">
                        <span id="player-status-label" class="player-status-label hidden"></span>
                    </div>
                </div>
                
                <div class="game-select-section">
                    <h3>Choose Your Game</h3>
                    <div class="game-select-buttons">
                        <button id="btn-snake-game" class="game-select-btn selected">
                            <span class="game-icon">üêç</span>
                            <span class="game-name">Snake</span>
                        </button>
                        <button id="btn-brawler-game" class="game-select-btn">
                            <span class="game-icon">‚öîÔ∏è</span>
                            <span class="game-name">Brawler</span>
                            <span class="in-dev-badge">In Dev</span>
                        </button>
                    </div>
                </div>
                
                <div class="menu-buttons" id="menu-buttons">
                    <button id="btn-single-player" class="btn btn-success">
                        <span class="btn-icon">üéÆ</span>
                        Start Game
                    </button>
                    <button id="btn-join-room" class="btn btn-secondary">
                        <span class="btn-icon">üö™</span>
                        Join Room
                    </button>
                    <button id="btn-browse-rooms" class="btn btn-tertiary">
                        <span class="btn-icon">üîç</span>
                        Browse Rooms
                    </button>
                    <button id="btn-leaderboard" class="btn btn-tertiary">
                        <span class="btn-icon">üèÜ</span>
                        Leaderboard
                    </button>
                </div>
                
<<<<<<< Current (Your changes)
                <div class="version-info">v0.4.0</div>
=======
                <div class="version-info">v0.5.0</div>
>>>>>>> Incoming (Background Agent changes)
            </div>
        </div>
        
        <!-- Join Room Modal -->
        <div id="join-modal" class="modal hidden">
            <div class="modal-content">
                <h2>Join Room</h2>
                <input type="text" id="room-code-input" maxlength="10" placeholder="Enter room code...">
                <div class="modal-buttons">
                    <button id="btn-join-confirm" class="btn btn-primary">Join</button>
                    <button id="btn-join-cancel" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Leaderboard Modal -->
        <div id="leaderboard-modal" class="modal hidden">
            <div class="modal-content leaderboard-modal">
                <h2>üèÜ Snake Leaderboard ‚Äî All Time Top 500</h2>
                <div class="lb-filter-row">
                    <select id="lb-mode-filter" class="lb-mode-select">
                        <option value="all">All Modes</option>
                        <option value="survival">Survival</option>
                        <option value="high_score">High Score</option>
                        <option value="battle_royale">Battle Royale</option>
                        <option value="duel">Duel</option>
                        <option value="single_player">Solo Practice</option>
                    </select>
                    <button id="lb-unique-toggle" class="lb-score-toggle" data-unique="false">
                        All Scores
                    </button>
                </div>
                <div id="leaderboard-list" class="leaderboard-list">
                    <div class="loading">Loading...</div>
                </div>
                <div class="leaderboard-pagination" id="leaderboard-pagination">
                    <button id="btn-lb-prev" class="btn btn-sm btn-secondary" disabled>‚óÄ Prev</button>
                    <span id="lb-page-info" class="lb-page-info">Page 1 / 1</span>
                    <button id="btn-lb-next" class="btn btn-sm btn-secondary" disabled>Next ‚ñ∂</button>
                </div>
                <div class="modal-buttons">
                    <button id="btn-leaderboard-close" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Room Browser -->
        <div id="browse-screen" class="screen hidden">
            <div class="browse-container">
                <h2>Available Rooms</h2>
                <div id="room-list" class="room-list">
                    <div class="loading">Searching for rooms...</div>
                </div>
                <div class="browse-buttons">
                    <button id="btn-refresh-rooms" class="btn btn-secondary">Refresh</button>
                    <button id="btn-back-menu" class="btn btn-tertiary">Back</button>
                </div>
            </div>
        </div>
        
        <!-- Lobby Screen -->
        <div id="lobby-screen" class="screen hidden">
            <div class="lobby-container">
                <div class="lobby-header">
                    <h2>Game Lobby</h2>
                    <div class="room-code-display">
                        <span>Room Code:</span>
                        <span id="lobby-room-code" class="code">----</span>
                        <button id="btn-copy-code" class="btn-icon-small" title="Copy code">üìã</button>
                    </div>
                </div>
                
                <div class="lobby-settings" id="lobby-settings">
                    <h3>Game Settings</h3>
                    <div class="setting-row">
                        <label>Game Mode</label>
                        <select id="select-game-mode">
                            <option value="survival" selected>Survival</option>
                            <option value="high_score">High Score</option>
                            <option value="battle_royale">Battle Royale</option>
                            <option value="duel">Duel</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>Barriers</label>
                        <select id="select-barrier-density">
                            <option value="none">None - Classic</option>
                            <option value="sparse">Sparse - Few Walls</option>
                            <option value="moderate">Moderate - Strategic</option>
                            <option value="dense">Dense - Maze</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>Map Size</label>
                        <select id="select-map-size">
                            <option value="small">Small (25x18)</option>
                            <option value="medium" selected>Medium (35x22)</option>
                            <option value="large">Large (45x28)</option>
                            <option value="extra_large">Extra Large (60x36)</option>
                        </select>
                    </div>
                    <div class="setting-row" id="time-limit-row">
                        <label>Time Limit</label>
                        <select id="select-time-limit">
                            <option value="30s">30 Seconds</option>
                            <option value="1m" selected>1 Minute</option>
                            <option value="2m">2 Minutes</option>
                            <option value="3m">3 Minutes</option>
                        </select>
                    </div>
                    <div class="setting-row" id="series-length-row" style="display:none">
                        <label>Series</label>
                        <select id="select-series-length">
                            <option value="3" selected>Best of 3</option>
                            <option value="5">Best of 5</option>
                            <option value="7">Best of 7</option>
                        </select>
                    </div>
                    <div class="setting-row ai-settings">
                        <label>AI Bots</label>
                        <select id="select-ai-count">
                            <option value="0" selected>None</option>
                            <option value="1">1 Bot</option>
                            <option value="2">2 Bots</option>
                            <option value="3">3 Bots</option>
                            <option value="4" class="br-only">4 Bots</option>
                            <option value="5" class="br-only">5 Bots</option>
                        </select>
                    </div>
                </div>
                
                <div class="player-list" id="player-list">
                    <!-- Players will be added here -->
                </div>
                
                <div class="lobby-chat">
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-input-row">
                        <input type="text" id="chat-input" placeholder="Type a message..." maxlength="200">
                        <button id="btn-send-chat" class="btn btn-small">Send</button>
                    </div>
                </div>
                
                <div class="lobby-buttons">
                    <button id="btn-ready" class="btn btn-primary">Ready</button>
                    <button id="btn-start-game" class="btn btn-success hidden">Start Game</button>
                    <button id="btn-lobby-leaderboard" class="btn btn-tertiary">üèÜ Leaderboard</button>
                    <button id="btn-lobby-profile" class="btn btn-tertiary">üë§ My Profile</button>
                    <button id="btn-leave-room" class="btn btn-danger">Leave</button>
                </div>
            </div>
        </div>
        
        <!-- Brawler Lobby Screen -->
        <div id="brawler-lobby-screen" class="screen hidden">
            <div class="lobby-container brawler-lobby">
                <div class="lobby-header">
                    <h2>‚öîÔ∏è Brawler Lobby <span class="in-dev-badge">In Dev</span></h2>
                    <div class="room-code-display">
                        <span>Room Code:</span>
                        <span id="brawler-room-code" class="code">----</span>
                        <button id="brawler-btn-copy-code" class="btn-icon-small" title="Copy code">üìã</button>
                    </div>
                </div>
                
                <div class="brawler-team-selection">
                    <h3>Choose Your Team</h3>
                    <div class="team-buttons">
                        <button id="team-blue-btn" class="team-btn team-blue">
                            <span class="team-name">Blue Team</span>
                            <span id="team-blue-count" class="team-count">0/2</span>
                        </button>
                        <span class="vs-text">VS</span>
                        <button id="team-red-btn" class="team-btn team-red">
                            <span class="team-name">Red Team</span>
                            <span id="team-red-count" class="team-count">0/2</span>
                        </button>
                    </div>
                </div>
                
                <div class="brawler-character-selection">
                    <h3>Choose Your Brawler</h3>
                    <div id="character-grid" class="character-grid">
                        <!-- Characters will be added dynamically -->
                    </div>
                </div>
                
                <div class="brawler-player-list-section">
                    <h3>Players</h3>
                    <div id="brawler-player-list" class="brawler-player-list">
                        <!-- Players will be added dynamically -->
                    </div>
                </div>
                
                <div class="lobby-buttons">
                    <button id="brawler-btn-ready" class="btn btn-primary" disabled>Ready</button>
                    <button id="brawler-btn-start" class="btn btn-success hidden">Start Game</button>
                    <button id="brawler-btn-leave" class="btn btn-danger">Leave</button>
                </div>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen hidden">
            <div id="game-wrapper">
                <!-- Left: player standings -->
                <div id="player-sidebar" class="legend-panel">
                    <div class="legend-title">üéÆ Players</div>
                    <div id="global-multipliers" class="global-mults hidden">
                        <div id="mult-speed" class="mult-row hidden">
                            <span class="mult-icon">‚ö°</span>
                            <span id="mult-speed-val" class="mult-val">1.00√ó</span>
                            <span class="mult-label">Speed</span>
                        </div>
                        <div id="mult-barrier" class="mult-row hidden">
                            <span class="mult-icon">üß±</span>
                            <span id="mult-barrier-val" class="mult-val">1.0√ó</span>
                            <span class="mult-label">Points</span>
                        </div>
                    </div>
                    <div id="player-standings"></div>
                </div>

                <div id="game-container">
                    <canvas id="game-canvas"></canvas>
                </div>

                <div id="animal-legend" class="legend-panel hidden">
                    <div class="legend-title">Animal Guide</div>

                    <div class="legend-category">
                        <div class="legend-cat-label">Small <span class="legend-pts">60‚Äì100 pts ¬∑ 1 hit</span></div>
                        <div class="legend-grid">
                            <div class="legend-item"><span class="legend-dot" style="background:#32CD32;"></span>Frog <em>85</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#FFC832;"></span>Bee <em>80</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#FF69B4;"></span>Butterfly <em>100</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#A9A9A9;"></span>Mouse <em>75</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#383838; border:1px solid #666;"></span>Spider <em>70</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#8B4513;"></span>Bug <em>65</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#553723;"></span>Cricket <em>65</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#FF9696;"></span>Worm <em>60</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#DC2828;"></span>Ladybug <em>70</em></div>
                        </div>
                    </div>

                    <div class="legend-category">
                        <div class="legend-cat-label">Medium <span class="legend-pts">80‚Äì120 pts ¬∑ 2-3 hits ¬∑ 0.8s cooldown</span></div>
                        <div class="legend-grid">
                            <div class="legend-item"><span class="legend-dot" style="background:#DCC8B4;"></span>Rabbit <em>90</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#64B4DC;"></span>Fish <em>80</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#3C783C;"></span>Lizard <em>120</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#50783C;"></span>Turtle <em>105</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#B48C50;"></span>Duck <em>120</em></div>
                        </div>
                    </div>

                    <div class="legend-category">
                        <div class="legend-cat-label">Large <span class="legend-pts">160‚Äì200 pts ¬∑ 4-5 hits ¬∑ 1.5s cooldown</span></div>
                        <div class="legend-grid">
                            <div class="legend-item"><span class="legend-dot" style="background:#D2691E;"></span>Fox <em>180</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#787882;"></span>Wolf <em>200</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#6495ED;"></span>Bird <em>160</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#B48C64;"></span>Deer <em>160</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#FFB4B4;"></span>Pig <em>160</em></div>
                        </div>
                    </div>

                    <div class="legend-category">
                        <div class="legend-cat-label">Huge <span class="legend-pts">260‚Äì400 pts ¬∑ 5 hits ¬∑ 2.5s cooldown</span></div>
                        <div class="legend-grid">
                            <div class="legend-item"><span class="legend-dot" style="background:#FFA532;"></span>Tiger <em>300</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#DCB464;"></span>Lion <em>350</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#644632;"></span>Bear <em>280</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#46643C;"></span>Croc <em>260</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#826E78;"></span>Hippo <em>375</em></div>
                            <div class="legend-item"><span class="legend-dot" style="background:#8C8C96;"></span>Elephant <em>400</em></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Duel series score banner ‚Äî persistent during duel games -->
            <div id="duel-series-bar" class="duel-series-bar hidden">
                <span id="duel-p1-name" class="duel-p-name"></span>
                <span id="duel-p1-score" class="duel-score">0</span>
                <span class="duel-dash">‚Äì</span>
                <span id="duel-p2-score" class="duel-score">0</span>
                <span id="duel-p2-name" class="duel-p-name"></span>
                <span id="duel-round-label" class="duel-round">Round 1</span>
            </div>
            <div id="game-hud">
                <div id="timer" class="hud-element">0:00</div>
                <div id="survival-pressure" class="hud-element hidden">
                    <div class="sp-row">
                        <span class="sp-icon">üçΩÔ∏è</span>
                        <div class="sp-bar-bg">
                            <div id="decay-bar-fill" class="sp-bar-fill"></div>
                        </div>
                        <span id="decay-label" class="sp-value">6.0s</span>
                    </div>
                    <div class="sp-row">
                        <span class="sp-icon">‚ö°</span>
                        <span id="speed-indicator" class="sp-value">1.0√ó</span>
                    </div>
                </div>
                <div id="scoreboard" class="hud-element"></div>
            </div>
            <div id="countdown-overlay" class="overlay hidden">
                <span id="countdown-number">3</span>
            </div>
            <!-- Duel round-over intermission overlay -->
            <div id="round-over-overlay" class="overlay hidden">
                <div class="round-over-content">
                    <h3 id="round-over-title">Round 1</h3>
                    <p id="round-over-winner"></p>
                    <div id="round-over-series" class="round-over-series"></div>
                    <p id="round-over-countdown" class="round-countdown">Next round in 5...</p>
                </div>
            </div>
            <!-- Shown to dead players in Survival while game is still running -->
            <div id="dead-overlay" class="overlay hidden">
                <div class="dead-overlay-content">
                    <div class="dead-icon">üíÄ</div>
                    <h3>You're Out!</h3>
                    <p>Watch the others or head back to the lobby.</p>
                    <button id="btn-leave-game" class="btn btn-danger">Leave Game</button>
                </div>
            </div>
            <div id="game-over-overlay" class="overlay hidden">
                <div class="game-over-content">
                    <h2 id="game-over-title">Game Over</h2>
                    <div id="final-scores"></div>
                    <button id="btn-back-lobby" class="btn btn-primary">Back to Lobby</button>
                </div>
            </div>
        </div>
        
        <!-- Profile Modal -->
        <div id="profile-modal" class="modal hidden">
            <div class="modal-content profile-modal">
                <h2>üë§ Player Profile</h2>
                <div id="profile-name-header" class="profile-name-header"></div>

                <div class="profile-filter-row">
                    <label class="lb-toggle-label">
                        <input type="checkbox" id="profile-ai-toggle" />
                        <span class="lb-toggle-text">Include AI-only games</span>
                    </label>
                </div>

                <div id="profile-stats" class="profile-stats">
                    <div class="profile-stat-row">
                        <span class="stat-label">Total Games</span>
                        <span id="stat-total-games" class="stat-value">‚Äî</span>
                    </div>
                    <div class="profile-stat-row">
                        <span class="stat-label">Total Wins</span>
                        <span id="stat-total-wins" class="stat-value">‚Äî</span>
                    </div>
                    <div class="profile-stat-row">
                        <span class="stat-label">Win Rate</span>
                        <span id="stat-win-pct" class="stat-value">‚Äî</span>
                    </div>
                    <div class="profile-stat-row profile-stat-divider">
                        <span class="stat-label" style="font-weight:600;color:var(--text-secondary)">By Game Mode</span>
                    </div>
                    <div id="profile-mode-stats"></div>
                    <div class="profile-stat-row profile-stat-divider">
                        <span class="stat-label" style="font-weight:600;color:var(--text-secondary)">Best Scores</span>
                    </div>
                    <div id="profile-best-scores"></div>
                    <div class="profile-stat-row profile-stat-divider" id="duel-stats-header" style="display:none">
                        <span class="stat-label" style="font-weight:600;color:var(--text-secondary)">Duel Record</span>
                    </div>
                    <div id="profile-duel-stats"></div>
                </div>

                <div id="profile-no-data" class="profile-no-data hidden">
                    <p>No games recorded yet.</p>
                    <p>Play your first game to start building your profile!</p>
                </div>

                <div class="profile-registered-date" id="profile-registered-date"></div>

                <div class="modal-buttons">
                    <button id="btn-profile-reset" class="btn btn-danger btn-sm">Reset Stats</button>
                    <button id="btn-profile-close" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>

        <!-- Connection Status -->
        <div id="connection-status" class="connection-indicator disconnected">
            <span class="status-dot"></span>
            <span class="status-text">Disconnected</span>
        </div>
        
        <!-- Error Toast -->
        <div id="error-toast" class="toast hidden">
            <span class="toast-message"></span>
        </div>
    </div>
    
    <script type="module" src="static/js/main.js"></script>
</body>
</html>
